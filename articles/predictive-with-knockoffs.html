<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="knockofftools">
<title>Deriving predictive variables using knockoffs • knockofftools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Deriving predictive variables using knockoffs">
<meta property="og:description" content="knockofftools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">knockofftools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/knockofftools.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/predictive-with-knockoffs.html">Deriving predictive variables using knockoffs</a>
    <a class="dropdown-item" href="../articles/simdata.html">The simdata dataset</a>
    <a class="dropdown-item" href="../articles/survival-analysis-with-knockoffs.html">Survival analysis with knockoffs</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Deriving predictive variables using knockoffs</h1>
                        <h4 data-toc-skip class="author">Kostas
Sechidis, Matthias Kormaksson</h4>
            
            <h4 data-toc-skip class="date">January 11, 2024</h4>
      
      
      <div class="d-none name"><code>predictive-with-knockoffs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we demonstrate how we can use knockofftools to
identify variables that modify the treatment effect. In particular
firstly we will introduce what predictive variables are, and then we
will present various knockoff based filter tailored to the task
identifying predictive variables. More details on this topic can be
found in <span class="citation">(<a href="#ref-predknockoffpaper" role="doc-biblioref">Sechidis, Kormaksson, and Ohlssen
2021</a>)</span></p>
<p>When we perform an intervention there are typically two types of
variables we are interested in. First, prognostic variables, which,
independent of the treatment, have a direct impact on the target <span class="math inline">\(Y.\)</span> Second, predictive variables, which
have an impact on the outcome by interacting with the treatment and
explain the heterogeneous treatment effect. To illustrate the
distinction between these two types of variables, a common approach is
to assume a known data generating model <span class="citation">(<a href="#ref-lipkovich2017tutorial" role="doc-biblioref">Lipkovich,
Dmitrienko, and B D’Agostino Sr 2017</a>)</span>: <span class="math display">\[\begin{align}
\mathbb{E}(Y| {X} = \mathbf{x} ,T = t) = h(\mathbf{x}) + g(\mathbf{x})t.
\end{align}\]</span> Prognostic variables are those that contribute to
<span class="math inline">\(h(\mathbf{x})\)</span> (i.e., ‘main
effects’), while predictive are the ones that contribute to <span class="math inline">\(g(\mathbf{x})\)</span>. The focus of this vignette
will be on the predictive variables. Here we will show how to use use
two different knockoff filters to discover predictive variables, while
controlling type-I error.</p>
</div>
<div class="section level2">
<h2 id="generate-synthetic-data">Generate synthetic data<a class="anchor" aria-label="anchor" href="#generate-synthetic-data"></a>
</h2>
<p>Before showing how to use the fitlers we will generate some synthetic
data, where we will know thw ground truth, i.e. which variables are
predictive. Firstly, we will load the package</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://opensource.nibr.com/knockofftools/">knockofftools</a></span><span class="op">)</span></span></code></pre></div>
<p>Then we will simulate 50 gaussian covariate predictors.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_X.html">generate_X</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">500</span>, p<span class="op">=</span><span class="fl">10</span>, p_b<span class="op">=</span><span class="fl">0</span>, cov_type<span class="op">=</span><span class="st">"cov_diag"</span>, rho<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p>Then we will calculate the linear predictor for the prognostic part
(<span class="math inline">\(h(\mathbf{x})\)</span>), where the first
<code>p_nn</code> regression coefficients are non-zero, all other are
set to zero. The (common) amplitude of the non-zero regression
coefficients is specified with <code>a</code>. In other words the first
<code>p_nn</code> variables are the <em>prognostic variables</em>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_lp.html">generate_lp</a></span><span class="op">(</span><span class="va">X</span>, p_nn <span class="op">=</span> <span class="fl">5</span>, a<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Then we will generate a binary variable that will serve as the
treatment indicator.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We will add in the linear predictor some interaction terms, in this
case the 6th and 7th variable are the <em>predictive variables</em>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lp.pred</span> <span class="op">=</span> <span class="va">lp</span> <span class="op">+</span> <span class="fl">1</span><span class="op">*</span><span class="va">trt</span><span class="op">*</span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="fl">7</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And finally, we will generate the outcome variable</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">lp.pred</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>So we want our filters to return the 6th and 7th variable, since are
the predictive ones, and at the same time provide the nominal
control.</p>
</div>
<div class="section level2">
<h2 id="filter-1-using-lasso-regression-coefficients-of-the-treatment-interaction-terms">Filter 1: Using LASSO regression coefficients of the treatment
interaction terms<a class="anchor" aria-label="anchor" href="#filter-1-using-lasso-regression-coefficients-of-the-treatment-interaction-terms"></a>
</h2>
<p>One direct way of deriving importance scores that capture the
predictive strength of each variable is to use a LASSO linear model,
modelling both main and interaction effects, and check the absolute
value of the coefficient of the interaction terms. In
<code>knockofftools</code> the function
<code>stat_predictive_glmnet</code> implements the filter that follows
this approach.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/knockoff.statistics.html">knockoff.statistics</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>, X<span class="op">=</span><span class="va">X</span>, type<span class="op">=</span><span class="st">"regression"</span>, statistic <span class="op">=</span> <span class="st">"stat_predictive_glmnet"</span>, trt<span class="op">=</span><span class="va">trt</span>, M<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running sequentially ('LOCAL') ...</span></span>
<span><span class="va">S</span> <span class="op">=</span> <span class="fu"><a href="../reference/variable.selections.html">variable.selections</a></span><span class="op">(</span><span class="va">W</span>, level <span class="op">=</span> <span class="fl">1</span>, error.type<span class="op">=</span><span class="st">"pfer"</span><span class="op">)</span></span>
<span><span class="va">S</span><span class="op">$</span><span class="va">stable.variables</span></span>
<span><span class="co">#&gt; [1] "X3" "X6" "X7"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="filter-2-using-importance-scores-derived-from-causal-forest">Filter 2: Using importance scores derived from causal forest<a class="anchor" aria-label="anchor" href="#filter-2-using-importance-scores-derived-from-causal-forest"></a>
</h2>
<p>Causal trees (CT), introduced by Athey and Imbens <span class="citation">(<a href="#ref-athey2016recursive" role="doc-biblioref">Athey and Imbens 2016</a>)</span>, is a recursive
partitioning algorithm for estimating heterogeneous treatment effects.
The main difference between CT and Classification and regression trees
(CART) is that CART focus on predicting the outcome <span class="math inline">\(Y,\)</span> while CT focus on estimating the
treatment effect. % for each example (patient). In CT, heterogeneous
effects are described by the conditional average treatment effect
(CATE): <span class="math inline">\(\mathbb{E} \left[ Y(1) - Y(0)| {X} =
\mathbf{x}\right]\)</span>.</p>
<p>We have implemented a knockoff filter that uses the importance scores
from the causal forest to derive predictive markers.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/knockoff.statistics.html">knockoff.statistics</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>, X<span class="op">=</span><span class="va">X</span>, type<span class="op">=</span><span class="st">"regression"</span>, statistic <span class="op">=</span> <span class="st">"stat_predictive_causal_forest"</span>, trt<span class="op">=</span><span class="va">trt</span>, M<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running sequentially ('LOCAL') ...</span></span>
<span><span class="va">S</span> <span class="op">=</span> <span class="fu"><a href="../reference/variable.selections.html">variable.selections</a></span><span class="op">(</span><span class="va">W</span>, level <span class="op">=</span> <span class="fl">1</span>, error.type<span class="op">=</span><span class="st">"pfer"</span><span class="op">)</span></span>
<span><span class="va">S</span><span class="op">$</span><span class="va">stable.variables</span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-athey2016recursive" class="csl-entry">
Athey, Susan, and Guido Imbens. 2016. <span>“Recursive Partitioning for
Heterogeneous Causal Effects.”</span> <em>Proceedings of the National
Academy of Sciences</em> 113 (27): 7353–60.
</div>
<div id="ref-lipkovich2017tutorial" class="csl-entry">
Lipkovich, Ilya, Alex Dmitrienko, and Ralph B D’Agostino Sr. 2017.
<span>“Tutorial in Biostatistics: Data-Driven Subgroup Identification
and Analysis in Clinical Trials.”</span> <em>Statistics in Medicine</em>
36 (1): 136–96.
</div>
<div id="ref-predknockoffpaper" class="csl-entry">
Sechidis, K., M. Kormaksson, and D. Ohlssen. 2021. <span>“Using
Knockoffs for Controlled Predictive Biomarker Identification.”</span>
<em>Statistics in Medicine</em>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthias Kormaksson, Kostas Sechidis, Manuela Zimmermann.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="knockofftools">
<title>Survival analysis with knockoffs • knockofftools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Survival analysis with knockoffs">
<meta property="og:description" content="knockofftools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">knockofftools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/knockofftools.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/predictive-with-knockoffs.html">Deriving predictive variables using knockoffs</a>
    <a class="dropdown-item" href="../articles/simdata.html">The simdata dataset</a>
    <a class="dropdown-item" href="../articles/survival-analysis-with-knockoffs.html">Survival analysis with knockoffs</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Survival analysis with knockoffs</h1>
                        <h4 data-toc-skip class="author">Matthias
Kormaksson, Kostas Sechidis</h4>
            
            <h4 data-toc-skip class="date">November 27, 2023</h4>
      
      
      <div class="d-none name"><code>survival-analysis-with-knockoffs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we demonstrate how to do knockoff variable selection
in the context of censored time-to-event data. We consider the following
Cox regression model for knockoff variable selection for time-to-event
data:</p>
<p><span class="math display">\[\begin{align}
\lambda(t) = \lambda_0(t) \exp \left(X \beta + \tilde{X} \tilde{\beta}
\right),
\end{align}\]</span></p>
<p>where <span class="math inline">\(\lambda(t)\)</span> is the hazard
function corresponding to a censored time-to-event response <span class="math inline">\(T\)</span> and <span class="math inline">\(\lambda_0(t)\)</span> is the baseline hazard. The
matrix <span class="math inline">\(X\)</span> is the design matrix
corresponding to the covariates of interest, while <span class="math inline">\(\tilde{X}\)</span> represents a knockoff copy of
<span class="math inline">\(X\)</span>.</p>
<p>Knockoff variable selection in Cox regression involves the following
steps:</p>
<ol style="list-style-type: decimal">
<li>Simulate a knockoff copy <span class="math inline">\(\tilde{X}\)</span> of the original covariates data
<span class="math inline">\(X\)</span>.</li>
<li>Compute feature statistics <span class="math inline">\(W_j=|\beta_j|-|\tilde{\beta}_j|\)</span> from the
aggregated Cox regression with covariates <span class="math inline">\(X\)</span> and <span class="math inline">\(\tilde{X}\)</span>. Large, positive statistics
<span class="math inline">\(W_j\)</span> indicate effect of <span class="math inline">\(X_j\)</span> on hazard rate.</li>
<li>For FDR control use the <em>knockoffs<span class="math inline">\(+\)</span></em> procedure to select variables
<span class="math inline">\(j\)</span> that fulfill <span class="math inline">\(W_j \geq \tau_+\)</span> where <span class="math display">\[
\tau_+ = \underset{t&gt;0}{\operatorname{argmin}} \left\{\frac{1 + |\{j
: W_j \leq t\}|}{|\{j : W_j \leq t\}|} \leq q\right\}.
\]</span> This workflow selects variables associated with response with
guaranteed control of false discovery rate <span class="math inline">\(FDR \leq q\)</span>.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://opensource.nibr.com/knockofftools/">knockofftools</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simdata">Data generation<a class="anchor" aria-label="anchor" href="#simdata"></a>
</h2>
<p>In this section we will simulate a toy data set with a known truth.
In particular, we will simulate a set of covariates <span class="math inline">\(X\)</span> and survival times under censoring that
are associated with some of the <span class="math inline">\(X\)</span>’s
through a Cox regression model.</p>
<p><em>Simulation of <span class="math inline">\(X\)</span>:</em> The
<code>generate_X</code> function simulates the rows of an <span class="math inline">\(n \times p\)</span> data frame <span class="math inline">\(X\)</span> independently from a multivariate
Gaussian distribution with mean <span class="math inline">\(0\)</span>
and <span class="math inline">\(p \times p\)</span> covariance matrix
<span class="math display">\[
\Sigma_{ij} = \left \{
\begin{array}{lr}
1\{i = j\}, &amp; \text{Independent,} \\
\rho^{1\{i \neq j\}}, &amp; \text{Equicorrelated,} \\
\rho^{|i-j|}, &amp; \text{AR1},
\end{array}
\right.
\]</span> where <span class="math inline">\(p_b\)</span> randomly
selected columns are then dichotomized with the indicator function <span class="math inline">\(\delta(x)=1(x &gt; 0)\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a 2000 x 30 Gaussian data.frame under equi-correlation(rho=0.5) structure, </span></span>
<span><span class="co"># with 10 of the columns  dichotomized</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_X.html">generate_X</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2000</span>, p<span class="op">=</span><span class="fl">30</span>, p_b<span class="op">=</span><span class="fl">10</span>, cov_type <span class="op">=</span> <span class="st">"cov_equi"</span>, rho<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>The covariance type is specified with the parameter
<code>cov_type</code> and the correlation coefficient with
<code>rho</code>. Each column of the resulting data.frame is either of
class <code>"numeric"</code> (for the continuous columns) or
<code>"factor"</code> (for the binary columns).</p>
<p><em>Simulation of event and censoring times:</em> The function
<code>simulWeib</code> simulates survival times <span class="math inline">\(T\)</span> from a Cox regression model</p>
<p><span class="math display">\[
\lambda(t) = \lambda_0(t) \exp \left(X \beta \right),
\]</span> with Weibull baseline hazard: <span class="math display">\[
\lambda_0(t) = \lambda_0 \rho t^{\rho-1}
\]</span> where <span class="math inline">\(\lambda_0 &gt; 0\)</span>
and <span class="math inline">\(\rho &gt; 0\)</span> are scale and shape
parameters, respectively. The censoring times <span class="math inline">\(C\)</span> are randomly drawn from an exponential
distribution with a small (fixed) rate <span class="math inline">\(\lambda_C=0.0005\)</span>, which results in very
mild censoring. Once <span class="math inline">\(T\)</span> and <span class="math inline">\(C\)</span> have been simulated the function sets
<code>time = min(T, C)</code> and <code>event = 1{T &lt; C}</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simulWeib</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">lambda0</span>, <span class="va">rho</span>, <span class="va">lp</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">lambdaC</span> <span class="op">=</span> <span class="fl">5e-04</span></span>
<span>    <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span>    <span class="va">Tlat</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">lambda0</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">rho</span><span class="op">)</span></span>
<span>    <span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, rate <span class="op">=</span> <span class="va">lambdaC</span><span class="op">)</span></span>
<span>    <span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">Tlat</span>, <span class="va">C</span><span class="op">)</span></span>
<span>    <span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Tlat</span> <span class="op">&lt;=</span> <span class="va">C</span><span class="op">)</span></span>
<span>    <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">time</span>, event <span class="op">=</span> <span class="va">status</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In this toy data set we assume that the first five covariates affect
the hazard <span class="math inline">\(\lambda(t)\)</span> through the
linear predictor <span class="math inline">\(\ell_p=X\beta\)</span> and
then simulate the survival object:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_lp.html">generate_lp</a></span><span class="op">(</span><span class="va">X</span>, p_nn<span class="op">=</span><span class="fl">5</span>, a<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulWeib.html">simulWeib</a></span><span class="op">(</span>N<span class="op">=</span><span class="fl">2000</span>, lambda <span class="op">=</span> <span class="fl">0.01</span>, rho <span class="op">=</span> <span class="fl">1</span>, lp <span class="op">=</span> <span class="va">lp</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="knockoff-feature-statistics-in-cox-regression">Knockoff (feature) statistics in Cox regression<a class="anchor" aria-label="anchor" href="#knockoff-feature-statistics-in-cox-regression"></a>
</h2>
<p>Let’s now use the <code>knockoff.statistics</code> function to (a)
simulate independently <span class="math inline">\(M\)</span> knockoffs
<span class="math inline">\(\tilde{X}_k\)</span>, <span class="math inline">\(k=1,\dots,M\)</span>, (b) fit the aggregated Cox
model to above data: <span class="math display">\[\begin{align}
\lambda(t) = \lambda_0(t) \exp \left(X \beta^{(k)} + \tilde{X}_k
\tilde{\beta}^{(k)} \right),
\end{align}\]</span> for each of the <span class="math inline">\(k=1,\dots,M\)</span> knockoff copies. Then finally
calculate (for each knockoff <span class="math inline">\(k\)</span>) the
corresponding knockoff (feature) statistics <span class="math inline">\(W^{(k)}_j =
|\beta_j^{(k)}|-|\tilde{\beta}_j^{(k)}|\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/knockoff.statistics.html">knockoff.statistics</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, type<span class="op">=</span><span class="st">"survival"</span>, M<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span></span>
<span><span class="co">#&gt;             W1          W2         W3        W4         W5          W6</span></span>
<span><span class="co">#&gt; X1  1.68417085  1.64920854 1.71294466 1.7130229 1.72623754  1.76959115</span></span>
<span><span class="co">#&gt; X2  1.78733106  1.79439991 1.82809127 1.7953936 1.80803144  1.83159085</span></span>
<span><span class="co">#&gt; X3  1.74840772  1.75951906 1.80838883 1.7588122 1.75238267  1.80715192</span></span>
<span><span class="co">#&gt; X4  1.72546124  1.67708322 1.78064956 1.7258980 1.74789299  1.73426786</span></span>
<span><span class="co">#&gt; X5  1.75046697  1.74950657 1.82076525 1.7650704 1.78235237  1.83577773</span></span>
<span><span class="co">#&gt; X6 -0.01921297 -0.01275992 0.01461379 0.0156508 0.01742504 -0.01154548</span></span>
<span><span class="co">#&gt;            W7         W8         W9          W10</span></span>
<span><span class="co">#&gt; X1 1.73428009 1.72061443 1.73521643  1.746217213</span></span>
<span><span class="co">#&gt; X2 1.80838108 1.77398820 1.80714829  1.804438638</span></span>
<span><span class="co">#&gt; X3 1.76401959 1.74515206 1.77405806  1.829114226</span></span>
<span><span class="co">#&gt; X4 1.72333722 1.71313170 1.72602257  1.779804692</span></span>
<span><span class="co">#&gt; X5 1.78468873 1.77687033 1.79819418  1.805816339</span></span>
<span><span class="co">#&gt; X6 0.00387067 0.01255798 0.01473674 -0.003842216</span></span></code></pre></div>
<p>The output is a data.frame whose columns are the <span class="math inline">\(M\)</span> knockoff statistics. In the above we
have used (as a default) parallel computing via the package
<code>clustermq</code> (see: <a href="https://cran.r-project.org/web/packages/clustermq/vignettes/userguide.html" class="external-link">User
Guide - clustermq</a>).</p>
</div>
<div class="section level2">
<h2 id="variable-selection-via-multiple-knockoffs">Variable selection via multiple knockoffs<a class="anchor" aria-label="anchor" href="#variable-selection-via-multiple-knockoffs"></a>
</h2>
<p>We simulated <span class="math inline">\(M = 10\)</span> feature
statistics in order to evaluate robustness of the knockoff variable
selection process, each time simulating a new knockoff of
<code>X</code>. To calculate which variables will be selected for each
of these knockoff statistics we use the <code>variable.selections</code>
function. This function takes the knockoff statistics <code>W</code> as
input and additionally specifies the <code>error.type="fdr"</code>
(default), <code>"pfer"</code> (per family error error), or
<code>"kfwer"</code> (k-familywise error rate) and the corresponding
target error level.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S</span> <span class="op">=</span> <span class="fu"><a href="../reference/variable.selections.html">variable.selections</a></span><span class="op">(</span><span class="va">W</span>, level <span class="op">=</span> <span class="fl">0.2</span>, error.type<span class="op">=</span><span class="st">"fdr"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">selected</span><span class="op">)</span></span>
<span><span class="co">#&gt;    S1 S2 S3 S4 S5 S6 S7 S8 S9 S10</span></span>
<span><span class="co">#&gt; X1  1  1  1  1  1  1  1  1  1   1</span></span>
<span><span class="co">#&gt; X2  1  1  1  1  1  1  1  1  1   1</span></span>
<span><span class="co">#&gt; X3  1  1  1  1  1  1  1  1  1   1</span></span>
<span><span class="co">#&gt; X4  1  1  1  1  1  1  1  1  1   1</span></span>
<span><span class="co">#&gt; X5  1  1  1  1  1  1  1  1  1   1</span></span>
<span><span class="co">#&gt; X6  0  0  0  1  0  0  0  0  0   0</span></span>
<span><span class="va">S</span><span class="op">$</span><span class="va">stable.variables</span></span>
<span><span class="co">#&gt; [1] "X1" "X2" "X3" "X4" "X5"</span></span></code></pre></div>
<p>In a nutshell the function will both calculate individual variable
selections (for each knockoff replicate) and a stable set of variables
that are selected most frequently among the <code>M</code> replicates.
For FDR-control the stable variables are calculated using the heuristics
in <a href="#multiple-knockoffs-filter-procedure">The multiple knockoffs
filter procedure</a>, while for the other two error types
(<code>"pfer"</code> and <code>"kfwer"</code>) we simply choose all
variables selected more than <code>thres*M</code> times, where
<code>thres</code> is an optional parameter of the
<code>variable.selections</code> function (<code>thres=0.5</code> by
default).</p>
</div>
<div class="section level2">
<h2 id="heatmap-of-multiple-variable-selections">Heatmap of multiple variable selections<a class="anchor" aria-label="anchor" href="#heatmap-of-multiple-variable-selections"></a>
</h2>
<p>In order to evaluate the robustness of the knockoff selection
procedure we can visualize a heatmap of the selections across the
knockoff replicates.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></code></pre></div>
<p><img src="survival-analysis-with-knockoffs_files/figure-html/unnamed-chunk-7-1.png" width="686.4">
We apply co-clustering of the rows and columns of the heatmap, which
identifies blocks of similarities in the binary selections. We then
order the blocks according to increasing mean number of selections. This
helps with aesthetics, but also helps visualize the most important
variables that should tend towards the top of the heatmap.</p>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="section level3">
<h3 id="multiple-knockoffs-filter-procedure">A. The multiple knockoffs filter procedure for FDR-control<a class="anchor" aria-label="anchor" href="#multiple-knockoffs-filter-procedure"></a>
</h3>
<p><span class="citation">(<a href="#ref-seqknockoffpaper" role="doc-biblioref">Kormaksson et al. 2021</a>)</span> introduced a
heuristic algorithm for selecting stable variables from multiple
independent knockoff variable selections.</p>
<p>Let <span class="math inline">\(\tilde{X}_1, \dots,
\tilde{X}_B\)</span> denote <span class="math inline">\(B\)</span>
independent knockoff copies of <span class="math inline">\(X\)</span>.
For each knockoff copy <span class="math inline">\(b\)</span> run the
knockoff filter and select the set of influential variables, <span class="math inline">\(S_b \subseteq \{1,\dots,p\}\)</span>. We propose
the following heuristics to select a final set of variables:</p>
<ul>
<li>Let <span class="math inline">\(F(r) \subseteq
\{1,\dots,p\}\)</span>, where <span class="math inline">\(r \in [0.5,
1]\)</span>, denote the set of variables selected more than <span class="math inline">\(r \cdot B\)</span> times out of the <span class="math inline">\(B\)</span> knockoff draws.</li>
<li>Let <span class="math inline">\(S(r)=\underset{b}{\rm mode}\{F(r)
\cap S_b\}\)</span> denote the set of selected variables that appears
most frequently, after filtering out variables that are not in <span class="math inline">\(F(r)\)</span>.</li>
<li>Return <span class="math inline">\(\hat{S} = S(\hat{r})\)</span>,
where <span class="math inline">\(\hat{r} = \underset{r \geq
0.5}{\operatorname{argmax}} |{S(r)}|\)</span>, i.e. the largest set
among <span class="math inline">\(\{S(r):r \geq 0.5\}\)</span>.</li>
</ul>
<p>The first step above essentially filters out variables that don’t
appear more than <span class="math inline">\((100\cdot r)\%\)</span> of
the time, which would seem like a reasonable requirement in practice
(e.g. with <span class="math inline">\(r=0.5\)</span>). The second step
above then filters the <span class="math inline">\(B\)</span> knockoff
selections <span class="math inline">\(S_b\)</span> accordingly and
searches for the most frequent variable set among those. The third step
then establishes the final selection, namely the most liberal variable
selection among the sets <span class="math inline">\(\{S(r):r \geq
0.5\}\)</span>.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-seqknockoffpaper" class="csl-entry">
Kormaksson, M., L. J. Kelly, X. Zhu, S. Haemmerle, L. Pricop, and D.
Ohlssen. 2021. <span>“Sequential Knockoffs for Continuous and
Categorical Predictors: With Application to a Large Psoriatic Arthritis
Clinical Trial Pool.”</span> <em>Statistics in Medicine</em>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthias Kormaksson, Kostas Sechidis, Manuela Zimmermann.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
